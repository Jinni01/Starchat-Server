<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>
        Starchat 관리자 도구
    </title>

    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://localhost/css/tool.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/moonspam/NanumSquare@1.0/nanumsquare.css">

    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" />
</head>

<body ontouchstart="">
    <div class="box-outline">
        <div class="menu-tab">
            <div class="box-tab"><button class="tab-userdb current">유저DB 보기</button></div>
            <div class="box-tab"><button class="tab-notice">공지사항 관리</button></div>
        </div>
        <div class="box-userdb current">
            <table class="table-list current">
                <tr>
                    <td>이메일</td>
                    <td>아이디</td>
                    <td>닉네임</td>
                    <td>성별</td>
                    <td>생일</td>
                    <td>지역</td>
                    <td>소개</td>
                    <td>별</td>
                </tr>
            </table>
        </div>

        <div class="list-notice">
            
        </div>


        <div class="box-floatmenu">
            <div class="button-newnoti"><img src="../../image/edit.svg" class="image-noti"></div>
            <div class="button-logout"><img src="../../image/logout.svg" class="image-logout"></div>
        </div>
    </div>

    <script type="text/javascript">
        $(".box-outline>.menu-tab>.box-tab>.tab-notice").click(() => {
            $(".box-outline>.menu-tab>.box-tab>.tab-userdb").removeClass("current");
            $(".box-outline>.box-userdb").removeClass("current");

            $(".box-outline>.menu-tab>.box-tab>.tab-notice").addClass("current");
            $(".box-outline>.list-notice").addClass("current");

            $(".box-floatmenu>.button-newnoti").addClass("current");
        });

        $(".box-outline>.menu-tab>.box-tab>.tab-userdb").click(() => {
            $(".box-outline>.menu-tab>.box-tab>.tab-notice").removeClass("current");
            $(".box-outline>.list-notice").removeClass("current");

            $(".box-outline>.menu-tab>.box-tab>.tab-userdb").addClass("current");
            $(".box-outline>.box-userdb").addClass("current");

            $(".box-floatmenu>.button-newnoti").removeClass("current");
        });

        $(".box-outline>.list-notice").on('click', ".title-notice", (event) => {
            const idx = $(event.target).data("idx");

            window.location.replace(window.location.protocol + "//" + window.location.host +
                "/admin/noti/view/" + idx);
        });

        $(window).load(() => {

            $.ajax({
                url: "http://localhost/user/list",
                method: "POST",
                dataType: "json"
            }).done((data, status, xhr) => {

                for (var i = 0; i < data.length; ++i) {
                    $(".box-outline>.box-userdb>.table-list").append("<tr>" +
                        "<td>" + data[i].email + "</td>" +
                        "<td>" + data[i].id + "</td>" +
                        "<td>" + data[i].nickname + "</td>" +
                        "<td>" + data[i].sex + "</td>" +
                        "<td>" + data[i].age + "</td>" +
                        "<td>" + data[i].region + "</td>" +
                        "<td>" + data[i].introduce + "</td>" +
                        "<td>" + data[i].star + "</td>" +
                        //"<td>" + data[i].profile + "</td>" +
                        "</tr>");
                }
            }).fail((xhr, err, status) => {
                //console.log(xhr);
                //console.log(err);
                //console.log(status);
            });

            $.ajax({
                url: "http://localhost/admin/noti/list",
                method: "POST",
                dataType: "json"
            }).done((data, status, xhr) => {
                if (data) {
                    for (var i = 0; i < data.length; ++i) {
                        $(".list-notice").append("<div class='title-notice' data-idx='" + data[i]
                            .index +
                            "'>" + data[i].title + "</div>");
                    }
                }
            }).fail((xhr, err, status) => {
                console.log(xhr);
                console.log(err);
                console.log(status);
            });
        });

        $(".box-floatmenu>.button-logout").click(() => {
            $.ajax({
                url: "http://localhost/user/logout",
                method: "POST",
                dataType: "json"
            }).done((data, status, xhr) => {
                window.location.replace(window.location.protocol + "//" + window.location.host +
                    "/admin");
            }).fail((xhr, err, status) => {
                //console.log(xhr);
                //console.log(err);
                //console.log(status);
            });
        });

        $(".box-floatmenu>.button-newnoti").click(() => {
            window.location.replace(window.location.protocol + "//" + window.location.host +
                "/admin/noti/new");
        });
    </script>
</body>